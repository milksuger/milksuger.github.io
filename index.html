<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="AI代码编辑器 - 智能代码生成工具">
    <title>AI代码编辑器</title>
    <link rel="stylesheet" href="style.css">
    <!-- 预加载关键资源 -->
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.45.0/min/vs/loader.min.js" as="script">
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" as="style">
    <!-- Monaco Editor -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.45.0/min/vs/loader.min.js" defer></script>
</head>
<body>
<div class="editor-root">
    <aside class="sidebar">
        <nav class="sidebar-nav">
            <button class="sidebar-btn" onclick="toggleHistory()" title="历史记录"><i class="fas fa-history"></i></button>
            <button class="sidebar-btn" onclick="toggleModelPanel()" title="模型列表"><i class="fas fa-robot"></i></button>
            <button class="sidebar-btn" onclick="openSettings()" title="接口设置"><i class="fas fa-cog"></i></button>
            <button class="sidebar-btn" onclick="toggleTheme()" title="切换主题"><i class="fas fa-moon"></i></button>
        </nav>
    </aside>
    <header class="topbar">
        <span class="project-title">AI代码生成器</span>
        <div class="topbar-actions">
            <!-- 可扩展全局操作按钮 -->
            <button class="main-generate-btn" style="margin-left: 18px; background: #fff; color: #2563eb; border: 1.5px solid #2563eb; font-size: 1rem; padding: 0.4rem 1.2rem;" onclick="window.location.href='about.html'">关于</button>
        </div>
    </header>
    <main class="main-area">
        <section class="input-panel">
            <h2>输入你的需求</h2>
            <textarea id="userInput" placeholder="请详细描述你想要生成的网页或功能，例如：'创建一个登录页面，包含用户名和密码输入框，以及登录按钮'"></textarea>
            <div class="btn-row input-btn-row">
                <button class="main-generate-btn polish-btn" id="polishBtn" onclick="polishUserInput()">润色需求</button>
                <button class="main-generate-btn" onclick="generateCode()">生成代码</button>
                <button class="main-generate-btn" id="generatePromptBtn" onclick="openPromptDialog()">生成需求</button>
            </div>
            <div id="polishResultWrapper" style="width:100%;margin:10px 0 0 0;display:none;flex-direction:column;gap:8px;">
                <div id="polishResult" style="background:#f8fafc;border:1.5px solid #e2e8f0;border-radius:8px;padding:0.8rem 1rem;min-height:48px;color:#23272f;font-size:1rem;white-space:pre-wrap;"></div>
                <button class="main-generate-btn" id="applyPolishBtn" style="align-self:flex-end;width:140px;background:#28a745;color:#fff;display:none;" onclick="applyPolishResult()">应用到输入框</button>
            </div>
        </section>
        <section class="output-panel">
            <div class="output-toolbar">
                <div class="view-switch">
                    <button id="previewBtn" class="active" onclick="switchView('preview')">网页效果</button>
                    <button id="codeBtn" onclick="switchView('code')">代码</button>
                </div>
                <div class="toolbar">
                    <button onclick="copyCode()" title="复制代码"><i class="fas fa-copy"></i></button>
                    <button onclick="formatCode()" title="格式化代码"><i class="fas fa-code"></i></button>
                    <button onclick="downloadCode()" title="下载代码"><i class="fas fa-download"></i></button>
                    <button onclick="previewInNewTab()" title="全屏预览"><i class="fas fa-external-link-alt"></i></button>
                    <button onclick="saveCodeSnippet()" title="保存代码片段"><i class="fas fa-save"></i></button>
                    <button onclick="compareVersions()" title="版本对比"><i class="fas fa-code-branch"></i></button>
                </div>
            </div>
            <div class="loading" id="loading">正在生成代码，请稍候...</div>
            <div id="previewArea" class="view-area"></div>
            <div class="code-wrapper view-area" style="display:none" id="codeWrapper">
                <div id="monacoEditor" style="width: 100%; height: 100%;"></div>
            </div>
        </section>
    </main>
    <footer class="statusbar">
        <span>当前模型：<span id="statusModel">-</span></span>
    </footer>
</div>

<div class="history-panel" id="historyPanel">
    <h2>历史记录</h2>
    <div id="historyList"></div>
</div>

<div class="settings-modal" id="settingsModal">
    <div class="settings-panel">
        <button class="close-btn" onclick="closeSettings()">&times;</button>
        <h2>接口设置</h2>
        <div class="input-group">
            <label for="apiKeyInput">API Key</label>
            <input type="password" id="apiKeyInput" placeholder="请输入你的API Key">
        </div>
        <div class="input-group">
            <label for="baseUrlInput">BaseURL</label>
            <input type="text" id="baseUrlInput" placeholder="如：https://api.siliconflow.cn/v1/chat/completions">
        </div>
        <div class="input-group">
            <label for="modelInput">模型名称</label>
            <input type="text" id="modelInput" placeholder="如：deepseek-ai/DeepSeek-R1-Distill-Qwen-7B">
        </div>
        <div class="btn-group">
            <button class="save-btn" onclick="saveSettings()">保存</button>
            <button class="default-btn" onclick="useDefaultConfig()">使用默认配置</button>
        </div>
    </div>
</div>

<div class="toast" id="toast"></div>

<div class="model-panel" id="modelPanel">
    <h2>模型列表</h2>
    <div id="modelList" class="model-list"></div>
</div>

<!-- 生成需求弹窗 -->
<div class="prompt-modal" id="promptModal" style="display:none;">
    <div class="prompt-panel">
        <button class="close-btn" onclick="closePromptDialog()">&times;</button>
        <h2>AI帮你写需求</h2>
        <textarea id="promptInput" placeholder="你可以简单描述你的想法（可选）"></textarea>
        <button class="main-generate-btn" onclick="generatePrompt()" id="generatePromptBtnDialog">生成需求文档</button>
        <div class="btn-group">
            <button class="default-btn" onclick="closePromptDialog()">关闭</button>
        </div>
    </div>
</div>

<!-- 移除重复的prompt-result-window，合并到prompt-modal中 -->
<div class="prompt-result-window" id="promptResultWindow" style="display:none;">
    <div class="prompt-result-content">
        <button class="close-btn" onclick="closePromptResultWindow()">&times;</button>
        <h2>AI帮你写需求</h2>
        <textarea id="promptResultInput" placeholder="你可以简单描述你的想法（可选）"></textarea>
        <div id="promptResultText" class="prompt-result-text"></div>
        <div class="btn-group">
            <button class="main-generate-btn" onclick="generatePrompt()" id="generatePromptBtnResult">生成需求文档</button>
            <button class="save-btn" onclick="usePromptResultText()">使用此需求</button>
            <button class="default-btn" onclick="closePromptResultWindow()">关闭</button>
        </div>
    </div>
</div>

<!-- 右侧浮动润色结果窗口 -->
<div id="polishFloatWindow" style="display:none;position:fixed;top:60px;right:32px;width:370px;max-width:90vw;z-index:3001;background:#fff;border-radius:14px;box-shadow:0 4px 24px 0 #60a5fa33;padding:1.5rem 1.2rem 1.2rem 1.2rem;flex-direction:column;gap:1.1rem;">
    <button id="closePolishFloatBtn" style="position:absolute;top:10px;right:10px;width:32px;height:32px;border:none;border-radius:50%;background:#e2e8f0;color:#2563eb;font-size:1.2rem;cursor:pointer;">×</button>
    <h3 style="margin:0 0 1rem 0;font-size:1.1rem;color:#2563eb;text-align:center;">AI润色结果</h3>
    <div id="polishFloatResult" style="background:#f8fafc;border:1.5px solid #e2e8f0;border-radius:8px;padding:0.8rem 1rem;min-height:48px;color:#23272f;font-size:1rem;white-space:pre-wrap;max-height:48vh;overflow-y:auto;"></div>
    <button class="main-generate-btn" id="applyPolishFloatBtn" style="width:140px;background:#28a745;color:#fff;align-self:flex-end;display:none;">应用到输入框</button>
</div>

<!-- 添加 Font Awesome 图标库 -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
<!-- 添加 Prettier 代码格式化库 -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/prettier/2.8.8/prettier.min.js" defer></script>
<script src="main.js" defer></script>
<script src="editor.js" defer></script>
<script>
// 使用立即执行函数避免全局变量污染
(function() {
    function previewInNewTab() {
        if (window.editor) {
            const code = editor.getValue();
            const win = window.open();
            win.document.open();
            win.document.write(code);
            win.document.close();
        }
    }
    // 将函数暴露到全局作用域
    window.previewInNewTab = previewInNewTab;
})();
</script>
</body>
</html> 